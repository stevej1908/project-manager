name: Production Deployment

on:
  push:
    branches: [ main, master ]

jobs:
  production-checks:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Setup Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '18'
        cache: 'npm'

    - name: Install dependencies
      run: |
        npm ci
        cd server && npm ci

    - name: Build production bundle
      run: npm run build
      env:
        CI: false
        GENERATE_SOURCEMAP: false
        REACT_APP_API_URL: ${{ secrets.PRODUCTION_API_URL }}

    - name: Check bundle size
      run: |
        echo "üì¶ Checking bundle size..."
        du -sh build/ || echo "Build directory size check"

  deploy-notification:
    runs-on: ubuntu-latest
    needs: production-checks
    if: success()

    steps:
    - name: Production deployment notice
      run: |
        echo "üöÄ PRODUCTION DEPLOYMENT"
        echo "Frontend: https://project-manager.vercel.app"
        echo "Backend: https://project-manager-api.vercel.app"
        echo ""
        echo "‚úÖ Vercel will auto-deploy to production"
        echo "‚ö†Ô∏è  Monitor error logs and analytics after deployment"

  # Optional: Notify team (Slack, email, etc.)
  # notify-team:
  #   runs-on: ubuntu-latest
  #   needs: deploy-notification
  #   steps:
  #   - name: Send Slack notification
  #     run: |
  #       curl -X POST ${{ secrets.SLACK_WEBHOOK }} \
  #         -H 'Content-Type: application/json' \
  #         -d '{"text":"üöÄ Production deployment successful!"}'
